# 画面設計仕様書 - Dining Memory App

## ドキュメント概要
- **作成日**: 2025年9月9日
- **対象**: MVP版の主要画面設計
- **技術スタック**: React Native + Expo
- **ターゲットユーザー**: 40代後半男性、技術リテラシー高、シンプルUI重視

## 全体ナビゲーション構造

### アプリ全体のナビゲーション
```
TabNavigation (ボトムタブ)
├── 📸 撮影 (CameraScreen)      ← メイン機能
├── 📋 記録 (RecordsScreen)     ← 一覧表示
├── 🔍 検索 (SearchScreen)      ← 検索機能
├── 📊 統計 (StatsScreen)       ← レポート
└── ⚙️ 設定 (SettingsScreen)    ← アプリ設定
```

### 画面遷移フロー
```
[CameraScreen] → [AI解析中] → [解析結果] → [編集] → [保存完了]
                      ↓
                 [エラー処理] → [手動入力] または [再撮影]
```

---

## CameraScreen（撮影画面）設計

### 基本レイアウト構成
```
┌─────────────────────────┐
│ ⚙️        🍽️ Dining      📋 │ ← ヘッダー（80pt）
│ 設定        Memory      記録 │
├─────────────────────────┤
│                         │
│                         │
│      カメラプレビュー    │ ← メイン領域
│         領域             │   （フルスクリーン）
│                         │
│                         │
│                         │
├─────────────────────────┤
│     📷       🔘       ⚡      │ ← ボトムコントロール
│  ギャラリー   撮影    フラッシュ │   （120pt）
└─────────────────────────┘
```

### 詳細仕様

#### ヘッダー部分
- **高さ**: 80pt（ステータスバー含む）
- **背景**: 半透明（カメラプレビューが透ける）
- **要素**:
  - 左上: ⚙️ 設定ボタン（44pt × 44pt）
  - 中央: アプリタイトル「🍽️ Dining Memory」
  - 右上: 📋 記録ボタン（バッジ付きで今日の記録数表示）

#### カメラプレビュー領域
- **表示**: フルスクリーンプレビュー
- **機能**:
  - リアルタイム物体認識（料理検出時にほんのり枠表示）
  - タップフォーカス・露出調整
  - ピンチズーム対応
  - ダブルタップでフロント/リアカメラ切替

#### ボトムコントロール
- **高さ**: 120pt
- **レイアウト**:
  - 左: 📷 ギャラリーボタン（最新写真のサムネイル表示）
  - 中央: 🔘 撮影ボタン（80pt、メインアクション）
  - 右: ⚡ フラッシュボタン（ON/OFF/Auto切り替え）

### インタラクション設計
- **撮影**: ワンタップで即撮影（シャッター音、ハプティックフィードバック）
- **連続撮影**: 長押しで連続撮影モード
- **モード切替**: 左右スワイプで撮影モード切替（食事/飲み物）
- **片手操作**: 親指で届く範囲にメインボタン配置

### 横画面対応
```
┌─────────────────────────────────────┐
│  ⚙️             🍽️ Dining            📋 │
│              カメラプレビュー          │
│                                     │
│📷  🔘  ⚡                           │
└─────────────────────────────────────┘
```

---

## AI解析関連画面設計

### 1. 解析中画面（Loading State）

#### レイアウト
```
┌─────────────────────────┐
│                         │
│      撮影した写真        │
│      (プレビュー)        │
│                         │
│    🤖 AI解析中...        │
│   ████████████████     │
│     推定残り 2秒         │
│                         │
│   [キャンセル] [再撮影]   │
└─────────────────────────┘
```

#### 進捗表示パターン
```
🤖 料理を分析しています...     (0-30%)
🍽️ 材料を特定しています...    (30-60%)
📝 情報をまとめています...     (60-90%)
✅ 解析完了！               (100%)
```

#### 技術仕様
- **処理時間**: TensorFlow Liteで3-5秒想定
- **キャンセル**: 処理中断してカメラ画面に戻る
- **タイムアウト**: 10秒超過でエラー処理へ

### 2. 解析結果表示画面

#### 成功時レイアウト
```
┌─────────────────────────┐
│  ✅ ラーメン（醤油）        │ ← メイン認識結果
├─────────────────────────┤
│      📸 撮影画像          │
│      (サムネイル)          │
├─────────────────────────┤
│ 🍜 メイン: ラーメン        │
│ 🥚 トッピング: 煮卵、ネギ  │
│ 🍺 ドリンク: ビール？      │ ← 不確実は？付き
├─────────────────────────┤
│ 📍 自宅                  │ ← 自動取得位置
│ ⏰ 2025/9/9 19:30       │ ← 撮影時刻
├─────────────────────────┤
│   [編集] [保存] [再撮影]   │
└─────────────────────────┘
```

#### 表示項目
- **メイン料理名**: 最高確信度の結果
- **材料・トッピング**: 認識できた要素一覧
- **推定ジャンル**: 和食、中華、洋食等
- **ドリンク**: 併せて写った飲み物
- **確信度表示**: 不確実な項目に？マーク
- **メタデータ**: GPS位置、撮影時刻（自動取得）

### 3. 編集画面

#### レイアウト
```
┌─────────────────────────┐
│ 📝 記録を編集             │
├─────────────────────────┤
│ 料理名: [ラーメン(醤油)] ✏️  │
│ ジャンル: [和食 ▼]         │
│ 材料: [煮卵,ネギ,海苔] ✏️   │
├─────────────────────────┤
│ 満足度: ⭐⭐⭐⭐⭐       │
│ メモ: [                 ] │
│      [美味しかった！]     │
├─────────────────────────┤
│ 場所: 📍 [自宅] ✏️        │
│ 日時: 📅 [9/9 19:30] ✏️   │
├─────────────────────────┤
│     [保存] [キャンセル]    │
└─────────────────────────┘
```

#### 編集可能項目
- **料理名**: フリーテキスト入力
- **ジャンル**: プルダウン選択（和食、中華、洋食、その他）
- **材料**: タグ形式で編集
- **満足度**: ★1-5のレーティング
- **メモ**: 自由記述テキスト
- **場所**: GPS結果の手動修正、よく行く店のプリセット
- **日時**: 撮影時刻の手動調整

### 4. エラー・失敗時画面

#### AI解析失敗時
```
┌─────────────────────────┐
│      😅 解析困難          │
├─────────────────────────┤
│      📸 撮影画像          │
├─────────────────────────┤
│  料理の特定ができませんでした │
│                         │
│ 手動で入力してください：     │
│ 料理名: [            ] │
│                         │
│  [手動入力] [再撮影]     │
└─────────────────────────┘
```

#### クラウドAI使用確認
```
┌─────────────────────────┐
│    🤖 より詳しく解析？     │
├─────────────────────────┤
│ ローカルAIでは認識困難です  │
│                         │
│ クラウドAIで再解析しますか？ │
│ (月の無料枠: 残り47回)    │
│                         │
│   [はい] [手動入力] [後で] │
└─────────────────────────┘
```

### 5. 保存完了画面

#### 成功フィードバック
```
┌─────────────────────────┐
│      ✅ 保存完了！         │
├─────────────────────────┤
│    ラーメン（醤油）        │
│     記録しました          │
├─────────────────────────┤
│  📊 今日の記録: 4件目     │
│  🍜 今月のラーメン: 8回   │
├─────────────────────────┤
│ [続けて撮影] [記録を見る]  │
└─────────────────────────┘
```

---

## 40代男性ターゲット向けUX設計方針

### 視認性重視
- **大きなボタン**: 最小44pt以上のタップターゲット
- **高コントラスト**: 暗い背景に明るいボタン
- **アイコン+テキスト**: 直感的理解のためのラベル併記
- **適切なフォントサイズ**: 16pt以上の読みやすいサイズ

### 操作性重視
- **片手操作対応**: 親指で届く範囲にメインボタン配置
- **誤操作防止**: 適度な間隔、重要でない操作は確認なし
- **直感的配置**: iOS/Android標準カメラアプリに近い配置
- **物理的フィードバック**: ハプティック、音響フィードバック

### 信頼性・透明性
- **AI結果の信頼性表示**: 確信度を正直に表示
- **手動修正の歓迎**: AIを盲信せず、ユーザー判断を尊重
- **データ保護**: 写真は即座に保存、損失リスクなし
- **段階的フォールバック**: ローカル→クラウド→手動の選択肢

### 実用性重視
- **統計情報提示**: 「今月○回目」等の実用的な情報
- **効率的デフォルト値**: 前回の場所、よく食べるもの
- **学習機能**: ユーザーの修正を学習して精度向上
- **オフライン動作**: ネット接続不要で基本機能動作

---

## 技術実装メモ

### React Native コンポーネント構成
```
CameraScreen/
├── CameraView.tsx          // メインカメラ表示
├── CameraControls.tsx      // 撮影コントロール
├── AnalysisOverlay.tsx     // AI解析結果オーバーレイ
└── components/
    ├── ShutterButton.tsx   // 撮影ボタン
    ├── FlashButton.tsx     // フラッシュ制御
    └── GalleryButton.tsx   // ギャラリーアクセス
```

### 状態管理
```typescript
interface CameraState {
  mode: 'camera' | 'analyzing' | 'result' | 'editing';
  photo: ImageData | null;
  analysisResult: AnalysisResult | null;
  isLoading: boolean;
  error: string | null;
}
```

### 使用するライブラリ
- `expo-camera`: カメラ機能
- `expo-image-picker`: ギャラリーアクセス
- `react-native-image-resizer`: 画像圧縮
- `@tensorflow/tfjs-react-native`: ローカルAI
- `expo-location`: GPS位置取得

---

## 今後の設計課題

### 未設計画面
1. **RecordsScreen**: 記録一覧表示画面
2. **SearchScreen**: 検索機能画面  
3. **StatsScreen**: 統計・レポート画面
4. **SettingsScreen**: アプリ設定画面

### 技術課題
1. **データベース設計**: SQLite スキーマ設計
2. **検索機能**: セマンティック検索の実装
3. **同期機能**: 端末間データ同期の仕組み
4. **パフォーマンス**: 大量画像の効率的表示

### UX改善
1. **オンボーディング**: 初回利用時の説明
2. **アクセシビリティ**: 視覚・聴覚サポート
3. **国際化**: 多言語対応（将来）
4. **ダークモード**: ライト/ダークテーマ対応

---

*このドキュメントは開発進捗に合わせて随時更新する*